<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahu Client Follow-up Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #eef2f7; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 900px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); margin-bottom: 25px; border-top: 5px solid #0d6efd; }
        .header-title { color: #0d6efd; font-weight: bold; margin-bottom: 30px; }
        .btn-primary { border-radius: 8px; padding: 10px 25px; transition: 0.3s; }
        .btn-success { border-radius: 8px; padding: 10px 25px; }
        #reportTable { margin-top: 20px; border-radius: 10px; overflow: hidden; }
        .loading-spinner { display: none; margin: 20px 0; }
        .badge-status { background-color: #ffc107; color: #000; padding: 5px 12px; border-radius: 50px; font-size: 0.85rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="text-center">
        <h2 class="header-title">üìä Client Follow-up Dashboard</h2>
    </div>

    <div class="card p-4">
        <h5 class="card-title mb-4">üÜï Nayi Entry Karein (Sahu System)</h5>
        <form id="entryForm">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Client ka Naam</label>
                    <input type="text" id="clientName" class="form-control" placeholder="Jaise: Sahu" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Kaam ka Type</label>
                    <select id="purpose" class="form-select">
                        <option value="Payment">Payment Dene wala hai</option>
                        <option value="Visit">Visit karne wala hai</option>
                        <option value="Call">Call karna hai</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Follow-up Date</label>
                    <input type="date" id="followupDate" class="form-control" required>
                </div>
                <div class="col-12 text-end mt-4">
                    <button type="submit" id="saveBtn" class="btn btn-primary">Data Save Karein</button>
                </div>
            </div>
        </form>
    </div>

    <div class="card p-4">
        <h5 class="card-title mb-4">üîç Daily Follow-up Report Check Karein</h5>
        <div class="row g-3 align-items-end">
            <div class="col-md-8">
                <label class="form-label">Date Chunein</label>
                <input type="date" id="searchDate" class="form-control">
            </div>
            <div class="col-md-4">
                <button onclick="getReport()" class="btn btn-success w-100">Report Dekhein</button>
            </div>
        </div>

        <div id="loading" class="loading-spinner text-center">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2 text-muted">Data fetch ho raha hai, kripya intezar karein...</p>
        </div>

        <div class="table-responsive">
            <table class="table table-hover d-none" id="reportTable">
                <thead class="table-primary">
                    <tr>
                        <th>Client Name</th>
                        <th>Purpose</th>
                        <th>Follow-up Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="reportBody"></tbody>
            </table>
        </div>
        <div id="noDataMessage" class="text-center mt-3 d-none text-danger">Is date ke liye koi follow-up nahi mila.</div>
    </div>
</div>

<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw4V6m3s-tTwjjQCDx24nhMbIcghhwgtWX9rTOTJFQk5DkIJQ8Q1zOFNVFGDUzgsDpR/exec";

    // 1. DATA ENTRY: Sheet mein data bhejta hai
    document.getElementById('entryForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('saveBtn');
        btn.disabled = true;
        btn.innerText = "Saving...";

        const data = {
            action: "add_entry",
            clientName: document.getElementById('clientName').value,
            purpose: document.getElementById('purpose').value,
            followupDate: document.getElementById('followupDate').value
        };

        // Note: mode 'no-cors' use ho raha hai isliye direct response handle nahi hoga par data save hoga
        fetch(WEB_APP_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        }).then(() => {
            alert("‚úì Success: Data Sheet mein save ho gaya!");
            document.getElementById('entryForm').reset();
            btn.disabled = false;
            btn.innerText = "Data Save Karein";
        }).catch(err => {
            console.error(err);
            alert("Kuch error aaya, please check console.");
            btn.disabled = false;
        });
    });

    // 2. GET REPORT: Sheet se data fetch karta hai
    async function getReport() {
        const searchDate = document.getElementById('searchDate').value;
        if(!searchDate) return alert("Pehle koi date select karein!");

        const loading = document.getElementById('loading');
        const table = document.getElementById('reportTable');
        const body = document.getElementById('reportBody');
        const noData = document.getElementById('noDataMessage');

        // Reset UI
        loading.style.display = 'block';
        table.classList.add('d-none');
        noData.classList.add('d-none');
        body.innerHTML = "";

        try {
            const response = await fetch(WEB_APP_URL, {
                method: "POST",
                body: JSON.stringify({ action: "get_report", searchDate: searchDate })
            });
            const data = await response.json();
            
            loading.style.display = 'none';
            
            if(data && data.length > 0) {
                data.forEach(row => {
                    body.innerHTML += `
                        <tr>
                            <td><strong>${row.name}</strong></td>
                            <td>${row.purpose}</td>
                            <td>${row.date}</td>
                            <td><span class="badge-status">Pending</span></td>
                        </tr>`;
                });
                table.classList.remove('d-none');
            } else {
                noData.classList.remove('d-none');
            }
        } catch (err) {
            loading.style.display = 'none';
            console.error(err);
            alert("Data fetch karne mein problem aayi. Check karein ki aapne Script 'Anyone' ke access ke sath deploy ki hai.");
        }
    }
</script>

</body>
</html>
